<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Detail - Analysis</title>
  
  <!-- Chart.js for charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      color: #333;
      padding: 20px;
      padding-top: 80px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 30px;
    }

    .back-button {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 25px;
      border-radius: 30px;
      text-decoration: none;
      font-weight: bold;
      font-size: 16px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      transition: all 0.3s;
    }

    .back-button:hover {
      transform: scale(1.05);
    }

    /* HEADER */
    .stock-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 3px solid #4CAF50;
    }

    .stock-name {
      font-size: 42px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 10px;
    }

    .current-price {
      font-size: 48px;
      font-weight: bold;
      color: #667eea;
      margin: 10px 0;
    }

    .price-change {
      font-size: 24px;
      font-weight: bold;
      padding: 10px 20px;
      border-radius: 25px;
      display: inline-block;
    }

    .price-change.positive {
      background: #d5f4e6;
      color: #27ae60;
    }

    .price-change.negative {
      background: #fadbd8;
      color: #e74c3c;
    }

    /* SIGNAL BOX */
    .signal-box {
      text-align: center;
      padding: 25px;
      margin: 30px 0;
      border-radius: 15px;
      font-size: 28px;
      font-weight: bold;
      color: white;
    }

    .signal-box.buy {
      background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
    }

    .signal-box.sell {
      background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
    }

    .signal-box.hold {
      background: linear-gradient(135deg, #f39c12 0%, #f1c40f 100%);
    }

    /* GRID LAYOUT */
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .info-box {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid #667eea;
    }

    .info-label {
      font-size: 14px;
      color: #7f8c8d;
      margin-bottom: 8px;
    }

    .info-value {
      font-size: 24px;
      font-weight: bold;
      color: #2c3e50;
    }

    /* EMA SECTION */
    .ema-section {
      margin: 30px 0;
      padding: 25px;
      background: linear-gradient(135deg, #667eea20 0%, #764ba220 100%);
      border-radius: 15px;
    }

    .section-title {
      font-size: 24px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .ema-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .ema-box {
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .ema-label {
      font-size: 14px;
      color: #7f8c8d;
      margin-bottom: 5px;
    }

    .ema-value {
      font-size: 28px;
      font-weight: bold;
      color: #667eea;
    }

    .ema-status {
      font-size: 12px;
      margin-top: 5px;
      padding: 4px 8px;
      border-radius: 12px;
      display: inline-block;
    }

    .ema-status.above {
      background: #d5f4e6;
      color: #27ae60;
    }

    .ema-status.below {
      background: #fadbd8;
      color: #e74c3c;
    }

    /* TREND ANALYSIS */
    .trend-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    .trend-box {
      background: white;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }

    .trend-label {
      font-size: 12px;
      color: #7f8c8d;
      margin-bottom: 8px;
    }

    .trend-value {
      font-size: 20px;
      font-weight: bold;
    }

    .trend-value.bullish {
      color: #27ae60;
    }

    .trend-value.bearish {
      color: #e74c3c;
    }

    /* CHART SECTION */
    .chart-section {
      margin: 30px 0;
      padding: 25px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .chart-container {
      position: relative;
      height: 400px;
      margin: 20px 0;
    }

    /* SUPPORT/RESISTANCE */
    .levels-section {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin: 30px 0;
    }

    .level-box {
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .level-box.resistance {
      background: #ffebee;
      border: 2px solid #e74c3c;
    }

    .level-box.support {
      background: #e8f5e9;
      border: 2px solid #27ae60;
    }

    .level-label {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .level-price {
      font-size: 32px;
      font-weight: bold;
      margin: 10px 0;
    }

    .level-distance {
      font-size: 14px;
      color: #7f8c8d;
    }

    /* INTRADAY CHART */
    .intraday-section {
      margin: 30px 0;
    }

    .loading {
      text-align: center;
      padding: 50px;
      font-size: 18px;
    }

    @media (max-width: 768px) {
      .ema-grid,
      .trend-grid,
      .levels-section {
        grid-template-columns: 1fr;
      }

      .stock-name {
        font-size: 28px;
      }

      .current-price {
        font-size: 36px;
      }
    }
  </style>
</head>
<body>

  <a href="all-stocks.html" class="back-button">‚Üê Back to All Stocks</a>

  <div class="container">
    <div id="loading" class="loading">Loading stock details...</div>
    
    <div id="stock-detail" style="display:none;">
      
      <!-- HEADER -->
      <div class="stock-header">
        <div class="stock-name" id="stock-name"></div>
        <div class="current-price" id="current-price"></div>
        <div class="price-change" id="price-change"></div>
        <div style="margin-top: 15px; color: #7f8c8d;">
          <span id="update-date"></span> | Updated: <span id="update-time"></span>
        </div>
      </div>

      <!-- SIGNAL BOX -->
      <div class="signal-box" id="signal-box"></div>

      <!-- KEY INFO -->
      <div class="info-grid">
        <div class="info-box">
          <div class="info-label">üìà Day High</div>
          <div class="info-value" id="day-high"></div>
          <div style="font-size: 12px; color: #7f8c8d; margin-top: 5px;" id="high-time"></div>
        </div>
        <div class="info-box">
          <div class="info-label">üìâ Day Low</div>
          <div class="info-value" id="day-low"></div>
          <div style="font-size: 12px; color: #7f8c8d; margin-top: 5px;" id="low-time"></div>
        </div>
        <div class="info-box">
          <div class="info-label">üîì Open</div>
          <div class="info-value" id="open-price"></div>
        </div>
        <div class="info-box">
          <div class="info-label">üü¢ Green Shadow</div>
          <div class="info-value" style="color: #27ae60;" id="green-shadow"></div>
        </div>
        <div class="info-box">
          <div class="info-label">üî¥ Red Shadow</div>
          <div class="info-value" style="color: #e74c3c;" id="red-shadow"></div>
        </div>
      </div>

      <!-- EMA ANALYSIS -->
      <div class="ema-section">
        <div class="section-title">
          üìä Exponential Moving Averages (EMA)
        </div>
        
        <div class="ema-grid">
          <div class="ema-box">
            <div class="ema-label">9-Day EMA</div>
            <div class="ema-value" id="ema-9"></div>
            <div class="ema-status" id="ema-9-status"></div>
          </div>
          <div class="ema-box">
            <div class="ema-label">20-Day EMA</div>
            <div class="ema-value" id="ema-20"></div>
            <div class="ema-status" id="ema-20-status"></div>
          </div>
          <div class="ema-box">
            <div class="ema-label">200-Day EMA</div>
            <div class="ema-value" id="ema-200"></div>
            <div class="ema-status" id="ema-200-status"></div>
          </div>
        </div>

        <!-- TREND ANALYSIS -->
        <div class="section-title" style="margin-top: 20px;">
          üìà Trend Analysis
        </div>
        <div class="trend-grid">
          <div class="trend-box">
            <div class="trend-label">Short Term (9 EMA)</div>
            <div class="trend-value" id="trend-short"></div>
          </div>
          <div class="trend-box">
            <div class="trend-label">Medium Term (20 EMA)</div>
            <div class="trend-value" id="trend-medium"></div>
          </div>
          <div class="trend-box">
            <div class="trend-label">Long Term (200 EMA)</div>
            <div class="trend-value" id="trend-long"></div>
          </div>
        </div>
      </div>

      <!-- SUPPORT & RESISTANCE -->
      <div class="section-title">üéØ Key Levels</div>
      <div class="levels-section">
        <div class="level-box resistance">
          <div class="level-label">üî¥ RESISTANCE</div>
          <div class="level-price" style="color: #e74c3c;" id="resistance"></div>
          <div class="level-distance" id="resistance-distance"></div>
        </div>
        <div class="level-box support">
          <div class="level-label">üü¢ SUPPORT</div>
          <div class="level-price" style="color: #27ae60;" id="support"></div>
          <div class="level-distance" id="support-distance"></div>
        </div>
      </div>

      <!-- HISTORICAL CHART -->
      <div class="chart-section">
        <div class="section-title">üìà 10-Day Price History</div>
        <div class="chart-container">
          <canvas id="historicalChart"></canvas>
        </div>
      </div>

      <!-- INTRADAY CHART -->
      <div class="chart-section intraday-section">
        <div class="section-title">‚ö° Today's Intraday Movement</div>
        <div class="chart-container">
          <canvas id="intradayChart"></canvas>
        </div>
      </div>

    </div>
  </div>

  <script>
    // Get stock name from URL
    const urlParams = new URLSearchParams(window.location.search);
    const stockName = urlParams.get('stock');

    if (!stockName) {
      document.getElementById('loading').innerHTML = 
        '<p style="color: #e74c3c;">Error: No stock specified!</p>';
    } else {
      loadStockDetail(stockName);
    }

    async function loadStockDetail(stockName) {
      try {
        const response = await fetch(`stock_details/${stockName}.json`);
        const data = await response.json();
        
        document.getElementById('loading').style.display = 'none';
        document.getElementById('stock-detail').style.display = 'block';
        
        // Update header
        document.getElementById('stock-name').textContent = data.name;
        document.getElementById('current-price').textContent = `‚Çπ${data.current_price}`;
        document.getElementById('update-date').textContent = data.date;
        document.getElementById('update-time').textContent = data.updated_time;
        
        // Price change
        const changeEl = document.getElementById('price-change');
        const changeClass = data.change >= 0 ? 'positive' : 'negative';
        const changeSign = data.change >= 0 ? '+' : '';
        changeEl.className = `price-change ${changeClass}`;
        changeEl.textContent = `${changeSign}‚Çπ${Math.abs(data.change)} / ${changeSign}${data.change_pct}%`;
        
        // Signal box
        const signalBox = document.getElementById('signal-box');
        signalBox.className = `signal-box ${data.trend.signal.toLowerCase()}`;
        signalBox.textContent = `${data.trend.signal} SIGNAL - Overall ${data.trend.overall} Trend`;
        
        // Key info
        document.getElementById('day-high').textContent = `‚Çπ${data.high}`;
        document.getElementById('high-time').textContent = `at ${data.key_levels.day_high_time}`;
        document.getElementById('day-low').textContent = `‚Çπ${data.low}`;
        document.getElementById('low-time').textContent = `at ${data.key_levels.day_low_time}`;
        document.getElementById('open-price').textContent = `‚Çπ${data.open}`;
        document.getElementById('green-shadow').textContent = `‚Çπ${data.shadows.green_shadow}`;
        document.getElementById('red-shadow').textContent = `‚Çπ${data.shadows.red_shadow}`;
        
        // EMAs
        document.getElementById('ema-9').textContent = data.ema.ema_9 ? `‚Çπ${data.ema.ema_9}` : 'N/A';
        document.getElementById('ema-20').textContent = data.ema.ema_20 ? `‚Çπ${data.ema.ema_20}` : 'N/A';
        document.getElementById('ema-200').textContent = data.ema.ema_200 ? `‚Çπ${data.ema.ema_200}` : 'N/A';
        
        // EMA status
        if (data.ema.ema_9) {
          const ema9Status = document.getElementById('ema-9-status');
          ema9Status.className = `ema-status ${data.current_price > data.ema.ema_9 ? 'above' : 'below'}`;
          ema9Status.textContent = data.current_price > data.ema.ema_9 ? 'Above' : 'Below';
        }
        
        if (data.ema.ema_20) {
          const ema20Status = document.getElementById('ema-20-status');
          ema20Status.className = `ema-status ${data.current_price > data.ema.ema_20 ? 'above' : 'below'}`;
          ema20Status.textContent = data.current_price > data.ema.ema_20 ? 'Above' : 'Below';
        }
        
        if (data.ema.ema_200) {
          const ema200Status = document.getElementById('ema-200-status');
          ema200Status.className = `ema-status ${data.current_price > data.ema.ema_200 ? 'above' : 'below'}`;
          ema200Status.textContent = data.current_price > data.ema.ema_200 ? 'Above' : 'Below';
        }
        
        // Trends
        const trendShort = document.getElementById('trend-short');
        trendShort.textContent = data.trend.short_term;
        trendShort.className = `trend-value ${data.trend.short_term.toLowerCase()}`;
        
        const trendMedium = document.getElementById('trend-medium');
        trendMedium.textContent = data.trend.medium_term;
        trendMedium.className = `trend-value ${data.trend.medium_term.toLowerCase()}`;
        
        const trendLong = document.getElementById('trend-long');
        trendLong.textContent = data.trend.long_term;
        trendLong.className = `trend-value ${data.trend.long_term === 'N/A' ? '' : data.trend.long_term.toLowerCase()}`;
        
        // Support & Resistance
        document.getElementById('resistance').textContent = `‚Çπ${data.support_resistance.resistance}`;
        document.getElementById('resistance-distance').textContent = 
          `‚Çπ${data.support_resistance.distance_to_resistance} away`;
        document.getElementById('support').textContent = `‚Çπ${data.support_resistance.support}`;
        document.getElementById('support-distance').textContent = 
          `‚Çπ${data.support_resistance.distance_to_support} away`;
        
        // Historical Chart
        createHistoricalChart(data.historical);
        
        // Intraday Chart
        createIntradayChart(data.intraday);
        
      } catch (error) {
        document.getElementById('loading').innerHTML = 
          `<p style="color: #e74c3c;">Error loading stock data: ${error.message}</p>
           <p>Make sure you run the analysis script first!</p>`;
      }
    }

    function createHistoricalChart(historical) {
      const ctx = document.getElementById('historicalChart').getContext('2d');
      
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: historical.dates,
          datasets: [{
            label: 'Closing Price',
            data: historical.prices,
            borderColor: '#667eea',
            backgroundColor: 'rgba(102, 126, 234, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top'
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              ticks: {
                callback: function(value) {
                  return '‚Çπ' + value;
                }
              }
            }
          }
        }
      });
    }

    function createIntradayChart(intraday) {
      const ctx = document.getElementById('intradayChart').getContext('2d');
      
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: intraday.map(d => d.time),
          datasets: [{
            label: 'Price',
            data: intraday.map(d => d.price),
            borderColor: '#27ae60',
            backgroundColor: 'rgba(39, 174, 96, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.3,
            pointRadius: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              ticks: {
                callback: function(value) {
                  return '‚Çπ' + value;
                }
              }
            },
            x: {
              ticks: {
                maxTicksLimit: 10
              }
            }
          }
        }
      });
    }
  </script>

</body>
</html>
