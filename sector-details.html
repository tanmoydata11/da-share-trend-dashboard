<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sector Analysis - Detailed View</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      color: #333;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }

    .header {
      text-align: center;
      padding: 20px 0;
      border-bottom: 3px solid #667eea;
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      color: #2c3e50;
      font-size: 32px;
      flex: 1;
    }

    .back-btn {
      padding: 12px 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-decoration: none;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      transition: transform 0.3s;
    }

    .back-btn:hover {
      transform: scale(1.05);
    }

    .section {
      margin-bottom: 40px;
    }

    .section-title {
      font-size: 26px;
      font-weight: bold;
      color: white;
      margin-bottom: 20px;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
      text-align: center;
    }

    .chart-container {
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .chart-wrapper {
      position: relative;
      height: 400px;
      width: 100%;
    }

    .chart-title {
      font-size: 20px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 20px;
      text-align: center;
    }

    .performance-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .sector-performance-card {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border-radius: 10px;
      padding: 25px;
      color: white;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .sector-performance-card.positive {
      background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
    }

    .sector-performance-card.negative {
      background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
    }

    .card-header {
      font-size: 22px;
      font-weight: bold;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.3);
    }

    .stock-info {
      background: rgba(255, 255, 255, 0.2);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .stock-name {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .stock-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
      font-size: 14px;
    }

    .detail-item {
      background: rgba(255, 255, 255, 0.15);
      padding: 8px;
      border-radius: 5px;
    }

    .detail-label {
      font-size: 12px;
      opacity: 0.9;
      margin-bottom: 4px;
    }

    .detail-value {
      font-size: 16px;
      font-weight: bold;
    }

    .loading {
      text-align: center;
      padding: 50px;
      font-size: 18px;
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 15px;
      }

      .header h1 {
        font-size: 24px;
      }

      .chart-wrapper {
        height: 300px;
      }

      .performance-grid {
        grid-template-columns: 1fr;
      }

      .stock-details {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div id="loading" class="loading">Loading sector analysis data...</div>
    <div id="content" style="display:none;">

      <!-- HEADER -->
      <div class="header">
        <div></div>
        <h1>üìä Detailed Sector Analysis</h1>
        <a href="index.html" class="back-btn">‚Üê Back to Dashboard</a>
      </div>

      <!-- SECTOR DISTRIBUTION PIE CHART -->
      <div class="section">
        <div class="section-title">üìä Sector Distribution & Overview</div>
        <div class="chart-container">
          <div class="chart-title">Sector-wise Stock Distribution</div>
          <div class="chart-wrapper">
            <canvas id="sectorPieChart"></canvas>
          </div>
        </div>
      </div>

      <!-- 7-DAY PERFORMANCE SECTION -->
      <div class="section">
        <div class="section-title">üìà 7-Day Sector Performance Trends</div>
        <div class="chart-container">
          <div class="chart-title">Daily Average Change by Sector</div>
          <div class="chart-wrapper">
            <canvas id="sevenDayChart"></canvas>
          </div>
        </div>
      </div>

      <!-- 1-MONTH PERFORMANCE SECTION -->
      <div class="section">
        <div class="section-title">üìä 1-Month Sector Performance</div>
        <div class="chart-container">
          <div class="chart-title">Sector Average Performance (Last 30 Days)</div>
          <div class="chart-wrapper">
            <canvas id="oneMonthChart"></canvas>
          </div>
        </div>

        <div class="section-title" style="font-size: 22px; margin-top: 30px;">
          üèÜ Top Performers & üìâ Biggest Losers by Sector
        </div>
        <div class="performance-grid" id="performance-grid"></div>
      </div>

    </div>
  </div>

  <script>
    let sectorChart = null;
    let sevenDayChart = null;
    let oneMonthChart = null;

    // Function to render sector pie chart
    function renderSectorPieChart(sectors) {
      const ctx = document.getElementById('sectorPieChart').getContext('2d');
      
      if (sectorChart) {
        sectorChart.destroy();
      }

      const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#C9CBCF', '#4BC0C0', '#FF9F40'];
      const labels = sectors.map(s => s.name);
      const stockCounts = sectors.map(s => s.stocks_count);
      const backgroundColors = colors.slice(0, sectors.length);

      sectorChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            label: 'Stocks Count',
            data: stockCounts,
            backgroundColor: backgroundColors,
            borderColor: '#ffffff',
            borderWidth: 3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                padding: 20,
                font: { size: 13, weight: 'bold' },
                color: '#2c3e50'
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const sector = sectors[context.dataIndex];
                  const percentage = ((context.parsed / stockCounts.reduce((a, b) => a + b, 0)) * 100).toFixed(1);
                  return `${sector.name}: ${sector.stocks_count} stocks (${percentage}%)`;
                }
              },
              backgroundColor: 'rgba(0, 0, 0, 0.85)',
              padding: 15
            }
          }
        }
      });
    }

    // Function to render 7-day bar chart
    function renderSevenDayChart(sevenDayData) {
      const ctx = document.getElementById('sevenDayChart').getContext('2d');
      
      if (sevenDayChart) {
        sevenDayChart.destroy();
      }

      const sectors = Object.keys(sevenDayData);
      const dates = sevenDayData[sectors[0]]?.dates || [];
      const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#C9CBCF'];

      const datasets = sectors.map((sector, index) => ({
        label: sector,
        data: sevenDayData[sector].daily_changes,
        backgroundColor: colors[index % colors.length],
        borderColor: colors[index % colors.length],
        borderWidth: 2
      }));

      sevenDayChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: dates.map(d => new Date(d).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })),
          datasets: datasets
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: { padding: 15, font: { size: 13, weight: 'bold' } }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { callback: function(value) { return value + '%'; } }
            }
          }
        }
      });
    }

    // Function to render 1-month bar chart
    function renderOneMonthChart(oneMonthData) {
      const ctx = document.getElementById('oneMonthChart').getContext('2d');
      
      if (oneMonthChart) {
        oneMonthChart.destroy();
      }

      const sectors = Object.keys(oneMonthData);
      const avgChanges = sectors.map(sector => oneMonthData[sector].avg_change);
      const backgroundColors = avgChanges.map(change => change >= 0 ? '#56ab2f' : '#eb3349');

      oneMonthChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: sectors,
          datasets: [{
            label: 'Average Change (%)',
            data: avgChanges,
            backgroundColor: backgroundColors,
            borderColor: backgroundColors,
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          indexAxis: 'y',
          plugins: {
            legend: { display: false }
          },
          scales: {
            x: {
              beginAtZero: true,
              ticks: { callback: function(value) { return value + '%'; } }
            }
          }
        }
      });
    }

    // Function to render performance cards
    function renderPerformanceCards(oneMonthData) {
      const performanceGrid = document.getElementById('performance-grid');
      const sectors = Object.keys(oneMonthData);

      performanceGrid.innerHTML = sectors.map(sector => {
        const data = oneMonthData[sector];
        const cardClass = data.avg_change >= 0 ? 'positive' : 'negative';

        return `
          <div class="sector-performance-card ${cardClass}">
            <div class="card-header">${sector} (Avg: ${data.avg_change >= 0 ? '+' : ''}${data.avg_change}%)</div>
            
            <div style="font-size: 18px; font-weight: bold; margin: 15px 0;">üèÜ Best Gainer</div>
            <div class="stock-info">
              <div class="stock-name">${data.best_gainer.name}</div>
              <div class="stock-details">
                <div class="detail-item">
                  <div class="detail-label">Change</div>
                  <div class="detail-value">‚Çπ${data.best_gainer.change}</div>
                </div>
                <div class="detail-item">
                  <div class="detail-label">Change %</div>
                  <div class="detail-value">${data.best_gainer.change_pct}%</div>
                </div>
              </div>
            </div>

            <div style="font-size: 18px; font-weight: bold; margin: 20px 0 15px 0;">üìâ Biggest Loser</div>
            <div class="stock-info">
              <div class="stock-name">${data.worst_loser.name}</div>
              <div class="stock-details">
                <div class="detail-item">
                  <div class="detail-label">Change</div>
                  <div class="detail-value">‚Çπ${data.worst_loser.change}</div>
                </div>
                <div class="detail-item">
                  <div class="detail-label">Change %</div>
                  <div class="detail-value">${data.worst_loser.change_pct}%</div>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Load sector details data
    async function loadSectorDetails() {
      try {
        const [dashResponse, sectorResponse] = await Promise.all([
          fetch('dashboard_data.json'),
          fetch('sector_details_data.json')
        ]);

        const dashData = await dashResponse.json();
        const sectorData = await sectorResponse.json();

        document.getElementById('loading').style.display = 'none';
        document.getElementById('content').style.display = 'block';

        // Render charts
        const sectors = dashData.sectors || [];
        if (sectors.length > 0) {
          renderSectorPieChart(sectors);
        }

        if (sectorData.seven_day) {
          renderSevenDayChart(sectorData.seven_day);
        }

        if (sectorData.one_month) {
          renderOneMonthChart(sectorData.one_month);
          renderPerformanceCards(sectorData.one_month);
        }

      } catch (error) {
        document.getElementById('loading').innerHTML =
          `<p style="color: #e74c3c;">‚ùå Error loading data: ${error.message}</p>
           <p>Please run: python analyze_stocks_enhanced.py</p>
           <p><a href="index.html" class="back-btn" style="display: inline-block; margin-top: 20px;">‚Üê Back to Dashboard</a></p>`;
        console.error('Error:', error);
      }
    }

    // Load data when page loads
    loadSectorDetails();
  </script>

</body>

</html>
